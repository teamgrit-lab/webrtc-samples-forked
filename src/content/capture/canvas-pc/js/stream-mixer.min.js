!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("StreamMixer",[],e):"object"==typeof exports?exports.StreamMixer=e():t.StreamMixer=e()}(this,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){console.log("%cStreamMixer 1.7.40","font-weight: 700;"),t.exports=i(1).default},function(t,e,i){"use strict";i.r(e);var s=function(){let t=null,e={videoMixer:null,videoElementList:0,droppedFrames:0};function i(){console.log(`%c[START TIME]%c : ${t}`,"font-weight: 700; color: white; background: orange;","font-weight: 400; background: none"),console.log(`%c[CURRENT TIME]%c : ${performance.now()}`,"font-weight: 700; color: white; background: orange;","font-weight: 400; background: none")}function s(t,e){console.log(`%c[DEBUG]%c(${t}) : ${e}`,"font-weight: 700; color: white; background: green;","font-weight: 400; background: none")}return{init:function(i,s){t=performance.now(),e.videoMixer=s,e.videoElementList=i},showObjectList:function(){s("ObjectList",e.videoElementList)},Frames:function(){let t=0,e=0;return{setLastExecuteTime:function(e){t=e},setLastFrameDelay:function(t){e=t},lastDrawTime:function(){i(),s("LastExecuteTime",t),s("LastFrameDelay",e),s("Total",t+e)}}}(),DroppedFrames:function(){return{increase:function(){e.droppedFrames=e.droppedFrames+1},show:function(){i(),s("DroppedFrames",e.droppedFrames);const o=(performance.now()-t)/1e3;s("DroppedFrames/s",e.droppedFrames/o)}}}()}}();class o{constructor({id:t,source:e=null,sourceType:i="stream",context:s,destination:o,mediaType:n,muted:h}){if(this._id=t,this._source=e,this._sourceType=i,this._audioCtx=s,this._destination=o,this._mediaType=n,this._muted=h,"stream"===this._sourceType?this._sourceNode=this._audioCtx.createMediaStreamSource(this._source):this._sourceNode=this._audioCtx.createMediaElementSource(this._source),this._gainNode=this._audioCtx.createGain(),"mycam"===n){this._gainNode.gain.value=.5;const t=this._audioCtx.createBiquadFilter();var a=Math.sqrt(102e4);t.frequency.value=a,t.Q.value=a/-3100,this._sourceNode.connect(t),t.connect(this._gainNode)}else this._gainNode.gain.value=1,this._sourceNode.connect(this._gainNode);this._gainNode.connect(this._destination)}get id(){return this._id}disconnect(){this._gainNode.disconnect(),this._sourceNode.disconnect()}mute(t){t?this._gainNode.gain.setValueAtTime(0,this._audioCtx.currentTime):this._gainNode.gain.setValueAtTime(1,this._audioCtx.currentTime)}setVolume(t){this._gainNode.gain.setValueAtTime(t,this._audioCtx.currentTime)}}class n{constructor(){const t=window.AudioContext||window.webkitAudioContext;this.audioCtx=new t,this.destination=this.audioCtx.createMediaStreamDestination(),this._isEnable=!0,this.audioObjectList=[],this.addNoiseOscillator()}addNoiseOscillator(){const t=this.audioCtx.createOscillator();t.type="sine",t.frequency.setValueAtTime(24e3,this.audioCtx.currentTime),t.connect(this.destination),t.start()}getContext(){return this.audioCtx}getDestination(){return this.destination}getMasterNode(){return this.masterNode}addAudioObject(t){this.audioObjectList.push(t)}removeAudioObject(t){const e=this.audioObjectList.findIndex(e=>e.id===t);-1!==e&&(this.audioObjectList[e].disconnect(),this.audioObjectList.splice(e,1))}getAudioTracks(){return this.destination.stream.getTracks()}mute(t,e){const i=this.audioObjectList.findIndex(e=>e.id===t);this.audioObjectList[i].mute(e)}setVolume(t,e){const i=this.audioObjectList.findIndex(e=>e.id===t);this.audioObjectList[i].setVolume(e)}}const h={width:1280,height:720},a={TOP:10,LEFT:10,RIGHT:10,BOTTOM:10},r={SMALL:{WIDTH:h.width/4,HEIGHT:h.height/4}},c={FULL:{top:0,left:0,width:h.width,height:h.height},LEFT_FULL:{top:0,left:0,width:h.width/2,height:h.height},RIGHT_FULL:{top:0,left:h.width/2,width:h.width/2,height:h.height},TOP_LEFT_SMALL:{top:a.TOP,left:a.LEFT,...r.SMALL},TOP_RIGHT_SMALL:{top:a.TOP,left:d(r.SMALL.WIDTH),...r.SMALL},TOP_CENTER_SMALL:{top:a.TOP,left:u(r.SMALL.WIDTH),...r.SMALL},BOTTOM_LEFT_SMALL:{top:l(r.SMALL.HEIGHT),left:a.LEFT,...r.SMALL},BOTTOM_RIGHT_SMALL:{top:l(r.SMALL.HEIGHT),left:d(r.SMALL.WIDTH),...r.SMALL},BOTTOM_CENTER_SMALL:{top:l(r.SMALL.HEIGHT),left:u(r.SMALL.HEIGHT),...r.SMALL}};function d(t){return h.width-t-a.RIGHT}function u(t){return h.width/2-t/2}function l(t){return h.height-t-a.BOTTOM}const f=50-1e3/60*.5,_=50,O=50,T=20;let m=0,v=0;const b={MIN_WIDTH:370,MIN_HEIGHT:208},g={POINT_SIZE:40,LINE_WIDTH:4,LINE_COLOR:"rgba(0,184,152,1)",Z_INDEX_BUTTON_WIDTH:80,Z_INDEX_BUTTON_HEIGHT:60,Z_INDEX_BUTTON_COLOR:"rgba(0,184,152,.75)",Z_INDEX_BUTTON_COLOR_UP:"rgba(0,184,152,.85)",Z_INDEX_BUTTON_COLOR_DOWN:"rgba(0,184,152,.5)",Z_INDEX_TEXT_FONT:"48px Arial",Z_INDEX_TEXT_FONT_SIZE:48,Z_INDEX_TEXT_WIDTH:80,Z_INDEX_TEXT_HEIGHT:80,ARROW_WIDTH:28,ARROW_HEIGHT:28,ARROW_COLOR:"#222222"},I={NONE:-1,CLICKED:0},w={Z_INDEX_MIN:1,Z_INDEX_MAX:9};class C{constructor(t,e){this.videoObjectList=[],this.videoObjectListAsc=[],this.optimizeDrawMode=!1,this.mouseButtonState=I.NONE,this.initCanvas(t),this.vRatio=h.width/this.uiCanvas.offsetWidth,this.hRatio=h.height/this.uiCanvas.offsetHeight,this.bindEventHandler(),this.requestAnimStartTime=0,this.recursiveStartTime=performance.now(),this.now=0,this.then=Date.now(),this.delta=0}initCanvas(t){this.uiCanvas=document.querySelector(`#${t}`),this.uiCanvasCtx=this.uiCanvas.getContext("2d",{desynchronized:!0,alpha:!1}),this.uiCanvas.width=h.width,this.uiCanvas.height=h.height,this.frontCanvas=document.createElement("canvas"),this.frontCanvas.width=h.width,this.frontCanvas.height=h.height,this.frontCanvasCtx=this.frontCanvas.getContext("2d",{desynchronized:!0,alpha:!1}),"undefined"!=typeof OffscreenCanvas?(this.bufferCanvas=new OffscreenCanvas(h.width,h.height),this.bufferCanvasCtx=this.bufferCanvas.getContext("2d",{desynchronized:!0,alpha:!1})):(this.bufferCanvas=this.frontCanvas,this.bufferCanvasCtx=this.frontCanvasCtx),this.mixedStream=this.frontCanvas.captureStream()}enableCanvas(t,e){const i=this.videoObjectList.findIndex(e=>e.id===t);this.videoObjectList[i].setEnable(e)}getVideoObject(t){const e=this.videoObjectList.findIndex(e=>e.id===t);return this.videoObjectList[e]}addVideoObject(t){this.videoObjectList.push(t),this.sortVideoObjectList()}removeVideoObject(t){const e=this.videoObjectList.findIndex(e=>e.id===t);this.videoObjectList.splice(e,1);const i=this.videoObjectListAsc.findIndex(e=>e.id===t);this.videoObjectListAsc.splice(i,1),this.detachEventObject()}setDrawMode(t){this.optimizeDrawMode=t}draw(t){t-m<O?window.requestAnimationFrame(this.draw.bind(this)):(m=t,this.bufferCanvasCtx.clearRect(0,0,h.width,h.height),this.bufferCanvasCtx.fillStyle="black",this.bufferCanvasCtx.fillRect(0,0,h.width,h.height),this.videoObjectList.map(t=>{const e=t.getDrawSource();if(!e)return;const{src:i}=e;this.bufferCanvasCtx.drawImage(i,t.left,t.top)}),this.frontCanvasCtx.drawImage(this.bufferCanvas,0,0),this.uiCanvasCtx.drawImage(this.frontCanvas,0,0),this.mouseOverObject&&(this.mouseOverObject.isFullscreen()||(this.drawOutline(),this.drawTriangle()),this.drawZIndexButton()),window.requestAnimationFrame(this.draw.bind(this)))}drawCalcDeltaTime(){window.requestAnimationFrame(this.drawCalcDeltaTime.bind(this)),this.now=Date.now(),this.delta=this.now-this.then,this.delta>_&&(this.then=this.now-this.delta%_,this.bufferCanvasCtx.clearRect(0,0,h.width,h.height),this.bufferCanvasCtx.fillStyle="black",this.bufferCanvasCtx.fillRect(0,0,h.width,h.height),this.videoObjectList.map(t=>{const e=t.getDrawSource();if(!e)return;const{src:i}=e;this.bufferCanvasCtx.drawImage(i,t.left,t.top)}),this.frontCanvasCtx.drawImage(this.bufferCanvas,0,0),this.uiCanvasCtx.drawImage(this.frontCanvas,0,0),this.mouseOverObject&&(this.mouseOverObject.isFullscreen()||(this.drawOutline(),this.drawTriangle()),this.drawZIndexButton()))}drawWithFps(){this.startTime=Date.now(),this.bufferCanvasCtx.clearRect(0,0,h.width,h.height),this.bufferCanvasCtx.fillStyle="black",this.bufferCanvasCtx.fillRect(0,0,h.width,h.height),this.videoObjectList.map(t=>{const e=t.getDrawSource();if(!e)return;const{src:i}=e;this.bufferCanvasCtx.drawImage(i,t.left,t.top)}),this.frontCanvasCtx.drawImage(this.bufferCanvas,0,0),this.uiCanvasCtx.drawImage(this.frontCanvas,0,0),this.mouseOverObject&&(this.mouseOverObject.isFullscreen()||(this.drawOutline(),this.drawTriangle()),this.drawZIndexButton()),this.mixedStream.getVideoTracks()[0].requestFrame(),this.executeTime=Date.now()-this.startTime,this.nextFrameDelay=O-this.executeTime,this.nextFrameDelay<=T&&(this.nextFrameDelay=T,s.DroppedFrames.increase()),s.Frames.setLastExecuteTime(this.executeTime),s.Frames.setLastFrameDelay(this.nextFrameDelay),setTimeout(this.drawWithFps.bind(this),this.nextFrameDelay)}sleep(t){const e=Date.now();for(;Date.now()-e<t;);}drawWithoutFps(t){this.bufferCanvasCtx.clearRect(0,0,h.width,h.height),this.bufferCanvasCtx.fillStyle="black",this.bufferCanvasCtx.fillRect(0,0,h.width,h.height),this.videoObjectList.map(t=>{const e=t.getDrawSource();if(!e)return;const{src:i}=e;this.bufferCanvasCtx.drawImage(i,t.left,t.top)}),this.frontCanvasCtx.drawImage(this.bufferCanvas,0,0),this.uiCanvasCtx.drawImage(this.frontCanvas,0,0),this.mouseOverObject&&(this.mouseOverObject.isFullscreen()||(this.drawOutline(),this.drawTriangle()),this.drawZIndexButton()),setTimeout(this.drawWithoutFps.bind(this),20)}drawOutline(){const t=this.mouseOverObject,e=this.uiCanvasCtx;e.strokeStyle=g.LINE_COLOR,e.lineWidth=g.LINE_WIDTH,e.strokeRect(t.left+parseInt(g.LINE_WIDTH/2),t.top+parseInt(g.LINE_WIDTH/2),t.width-parseInt(g.LINE_WIDTH+1),t.height-parseInt(g.LINE_WIDTH+1))}drawTriangle(){const t=this.mouseOverObject,e=this.uiCanvasCtx;(()=>{e.beginPath();let i=t.left,s=t.top;e.moveTo(i,s),i=t.left+g.POINT_SIZE,s=t.top,e.lineTo(i,s),i=t.left,s=t.top+g.POINT_SIZE,e.lineTo(i,s),e.closePath(),e.fillStyle=g.LINE_COLOR,e.fill()})(),(()=>{e.beginPath();let i=t.left+t.width,s=t.top+t.height-g.POINT_SIZE;e.moveTo(i,s),i=t.left+t.width,s=t.top+t.height,e.lineTo(i,s),i=t.left+t.width-g.POINT_SIZE,s=t.top+t.height,e.lineTo(i,s),e.closePath(),e.fillStyle=g.LINE_COLOR,e.fill()})()}drawZIndexButton(){const t=this.mouseOverObject,e=this.uiCanvasCtx;let i=t.top+g.LINE_WIDTH,s=t.left+t.width-g.LINE_WIDTH;t.isFullscreen()&&(s=h.width);(()=>{const t=t=>{e.fillStyle=t,e.fillRect(s-g.Z_INDEX_BUTTON_WIDTH,i,g.Z_INDEX_BUTTON_WIDTH,g.Z_INDEX_BUTTON_HEIGHT)},o=t=>{e.fillStyle=t,e.fillRect(s-g.Z_INDEX_BUTTON_WIDTH,i+g.Z_INDEX_BUTTON_HEIGHT,g.Z_INDEX_BUTTON_WIDTH,g.Z_INDEX_BUTTON_HEIGHT)};switch(this.clickPosition){case"up-arrow":this.mouseButtonState===I.NONE?t(g.Z_INDEX_BUTTON_COLOR_UP):this.mouseButtonState===I.CLICKED&&t(g.Z_INDEX_BUTTON_COLOR_DOWN),o(g.Z_INDEX_BUTTON_COLOR);break;case"down-arrow":this.mouseButtonState===I.NONE?o(g.Z_INDEX_BUTTON_COLOR_UP):this.mouseButtonState===I.CLICKED&&o(g.Z_INDEX_BUTTON_COLOR_DOWN),t(g.Z_INDEX_BUTTON_COLOR);break;default:t(g.Z_INDEX_BUTTON_COLOR),o(g.Z_INDEX_BUTTON_COLOR)}})(),(()=>{e.beginPath();let t=s-g.Z_INDEX_BUTTON_WIDTH/2,o=i+(g.Z_INDEX_BUTTON_HEIGHT-g.ARROW_HEIGHT)/2;e.moveTo(t,o),t+=g.ARROW_WIDTH/2,o+=g.ARROW_HEIGHT,e.lineTo(t,o),t-=g.ARROW_WIDTH,e.lineTo(t,o),e.closePath(),e.fillStyle=g.ARROW_COLOR,e.fill()})(),(()=>{e.beginPath();let t=s-g.Z_INDEX_BUTTON_WIDTH/2,o=i+g.Z_INDEX_BUTTON_HEIGHT+(g.Z_INDEX_BUTTON_HEIGHT/2+g.ARROW_HEIGHT/2);e.moveTo(t,o),t+=g.ARROW_WIDTH/2,o-=g.ARROW_HEIGHT,e.lineTo(t,o),t-=g.ARROW_WIDTH,e.lineTo(t,o),e.closePath(),e.fillStyle=g.ARROW_COLOR,e.fill()})()}captureFrame(t){t-v<f?window.requestAnimationFrame(this.captureFrame.bind(this)):(v=t,this.frontCanvasCtx.drawImage(this.canvas,0,0),this.mixedStream.getVideoTracks()[0].requestFrame(),window.requestAnimationFrame(this.captureFrame.bind(this)))}getVideoTracks(){return this.mixedStream.getVideoTracks()}sortVideoObjectList(){this.videoObjectList.sort(function(t,e){return t.zIndex<e.zIndex?-1:t.zIndex>e.zIndex?1:t.createdAt<e.createdAt?-1:t.createdAt>e.createdAt?1:0}),this.videoObjectListAsc=[];for(let t=this.videoObjectList.length-1;t>=0;t--)this.videoObjectListAsc.push(this.videoObjectList[t])}bindEventHandler(){this.uiCanvas.ondblclick=t=>{const{clickObj:e,clickPosition:i}=this.findClickObject(t);if(e&&"move"===i){if(e.isFullscreen()){if(e.hasSavedPosition())e.restorePosition();else{e.savePosition();let t=b.MIN_WIDTH,i=b.MIN_HEIGHT;if(e.width>e.height){const s=e.height/e.width;i=(t=b.MIN_WIDTH)*s}else{const s=e.width/e.height;t=(i=b.MIN_HEIGHT)*s}e.setPosition({top:10,left:10,width:t,height:i,zIndex:e.zIndex,fullScreen:!1})}this.mouseOverObject=e}else{e.savePosition();let t=e.width/e.height;if(t>0){const i=h.width,s=h.width/t;s>h.height?e.setPosition({top:0,left:0,width:h.height*t,height:h.height,fullScreen:!0}):e.setPosition({top:0,left:0,width:i,height:s,fullScreen:!0})}else{const i=h.height,s=h.height*t;e.setPosition({top:0,left:0,width:s,height:i,fullScreen:!0})}this.mouseOverObject=null}this.sortVideoObjectList()}},this.uiCanvas.onmousedown=t=>{const{clickObj:e,clickPosition:i}=this.findClickObject(t);if(this.mouseButtonState=t.button,e){if(e.isFullscreen())return;this.clickObject=e,this.clickPosition=i,this.startPos={x:t.offsetX,y:t.offsetY},this.startObjectPos={top:e.top,left:e.left,bottom:h.height-(e.top+e.height),right:h.width-(e.left+e.width),width:e.width,height:e.height,ratio:e.height/e.width}}else this.detachEventObject()},this.uiCanvas.onmouseover=t=>{const{clickObj:e,clickPosition:i}=this.findClickObject(t);this.mouseOverObject=e,this.clickPosition=i},this.uiCanvas.onmouseout=t=>{this.detachEventObject()},this.uiCanvas.onmousemove=t=>{switch(this.mouseButtonState){case I.NONE:this.mouseOverObject&&this.detectMouseOut(t);const{clickObj:e,clickPosition:i}=this.findClickObject(t);if(e)switch(this.mouseOverObject=e,this.clickPosition=i,i){case"up-arrow":case"down-arrow":this.uiCanvas.style.cursor="pointer";break;case"move":e.isFullscreen()||(this.uiCanvas.style.cursor="move");break;case"top-left":case"bottom-right":e.isFullscreen()||(this.uiCanvas.style.cursor="nwse-resize")}break;case I.CLICKED:if(this.clickObject){const e=t.offsetX-this.startPos.x,i=t.offsetY-this.startPos.y;let s=this.calcUItoCanvasX(e),o=this.calcUItoCanvasY(i),n=this.startObjectPos.width,h=n*this.startObjectPos.ratio;switch(this.clickPosition){case"top-left":if(s*=-1,h=(n=this.startObjectPos.width+s)*this.startObjectPos.ratio,n<b.MIN_WIDTH)return;if(h<b.MIN_HEIGHT)return;this.clickObject.setPosition({bottom:this.startObjectPos.bottom,right:this.startObjectPos.right,width:n,height:h});break;case"bottom-right":if(h=(n=this.startObjectPos.width+s)*this.startObjectPos.ratio,n<b.MIN_WIDTH)return;if(h<b.MIN_HEIGHT)return;this.clickObject.setPosition({top:this.startObjectPos.top,left:this.startObjectPos.left,width:n,height:h});break;case"move":if(this.clickObject.isFullscreen())return;this.clickObject.left=this.startObjectPos.left+s,this.clickObject.top=this.startObjectPos.top+o}}}},this.uiCanvas.onmouseup=t=>{this.mouseButtonState=I.NONE},this.uiCanvas.onclick=t=>{const{clickObj:e,clickPosition:i}=this.findClickObject(t);"up-arrow"===i?e.zIndex<w.Z_INDEX_MAX&&(e.zIndex=e.zIndex+1,this.sortVideoObjectList()):"down-arrow"===i&&e.zIndex>w.Z_INDEX_MIN&&(e.zIndex=e.zIndex-1,this.sortVideoObjectList())}}calcUItoCanvasX(t){return parseInt(t*this.vRatio)}calcUItoCanvasY(t){return parseInt(t*this.hRatio)}findClickObject(t){let e=this.videoObjectListAsc;const i=this.calcUItoCanvasX(t.offsetX),s=this.calcUItoCanvasY(t.offsetY);let o="move";return{clickObj:e.find(t=>{let e=t.top,n=t.left,a=t.top+t.height,r=t.left+t.width;return t.isFullscreen()&&(e=0,n=0,a=h.height,r=h.width),s>=e&&s<=e+g.POINT_SIZE&&i>=n&&i<=n+g.POINT_SIZE?(o="top-left",t):s>=a-g.POINT_SIZE&&s<=a&&i>=r-g.POINT_SIZE&&i<=r?(o="bottom-right",t):s>=e&&s<=e+g.Z_INDEX_BUTTON_HEIGHT&&i>=r-g.Z_INDEX_BUTTON_WIDTH&&i<=r?(o="up-arrow",t):s>=e+g.Z_INDEX_BUTTON_HEIGHT&&s<=e+2*g.Z_INDEX_BUTTON_HEIGHT&&i>=r-g.Z_INDEX_BUTTON_WIDTH&&i<=r?(o="down-arrow",t):s>=e&&s<=a&&i>=n&&i<=r?(o="move",t):void 0}),clickPosition:o}}detachEventObject(){this.uiCanvas.style.cursor=null,this.mouseOverObject=null,this.clickObject=null,this.clickPosition=null,this.startPos=null,this.startObjectPos=null,this.mouseButtonState=I.NONE}detectMouseOut(t){if(!this.mouseOverObject)return;const e=parseInt(t.offsetX*this.vRatio),i=parseInt(t.offsetY*this.hRatio);(e<this.mouseOverObject.left||e>this.mouseOverObject.right||e>this.mouseOverObject.left+this.mouseOverObject.width||i<this.mouseOverObject.top||i>this.mouseOverObject.bottom||i>this.mouseOverObject.top+this.mouseOverObject.height)&&(this.uiCanvas.style.cursor=null,this.mouseOverObject=null)}}class p{constructor(t){const{id:e,top:i,left:s,bottom:o,right:n,width:h=0,height:a=0,zIndex:r=0,fullScreen:c=!1,frameRate:d=30,autoSize:u=!1,transparent:l=!1,onended:f=null,enabled:_=!0,source:O,sourceType:T="stream"}=t;if(this._id=e,this._transparent=l,this._enabled=_,this._source=O,this._sourceType=T,this._top=i,this._left=s,this._bottom=o,this._right=n,this._width=h,this._height=a,this._zIndex=r,this._fullScreen=c,this._frameRate=d,this._createdAt=performance.now(),u){const t=h/this._source.videoWidth;this._source.videoWidth,this._source.videoHeight;this._height=this._source.videoHeight*t}"undefined"!=typeof OffscreenCanvas?this._offscreenCanvas=new OffscreenCanvas(this._width,this._height):this._offscreenCanvas=document.createElement("canvas"),this._offscreenCanvasCtx=this._offscreenCanvas.getContext("2d",{desynchronized:!0,alpha:!1}),this.setPosition({top:this._top,left:this._left,bottom:this._bottom,right:this._right,width:this._width,height:this._height}),this.autoDraw()}get id(){return this._id}setEnable(t){this._enabled=t,t||(this._offscreenCanvasCtx.fillStyle="black",this._offscreenCanvasCtx.fillRect(0,0,this._offscreenCanvas.width,this._offscreenCanvas.height))}get enabled(){return this._enabled}autoDraw(){this.draw(),window.requestAnimationFrame(this.autoDraw.bind(this))}draw(){if(this._fullScreen){this._offscreenCanvasCtx.clearRect(0,0,h.width,h.height),this._offscreenCanvasCtx.fillStyle="black",this._offscreenCanvasCtx.fillRect(0,0,h.width,h.height);const t=parseInt((h.width-this._width)/2),e=parseInt((h.height-this._height)/2);this._offscreenCanvasCtx.drawImage(this._source,t,e,this._width,this._height)}else this._offscreenCanvasCtx.drawImage(this._source,0,0,this._width,this._height)}getDrawSource(){if(!this._enabled)return;const t=Math.max(this._source.videoWidth||0,this._source.width||0),e=Math.max(this._source.videoHeight||0,this._source.height||0);return 0!==t&&0!==e?{src:this._offscreenCanvas,srcWidth:t,srcHeight:e}:void 0}isFullscreen(){return this._fullScreen}hasSavedPosition(){return this._savedPosition}savePosition(){this._oldTop=this._top,this._oldLeft=this._left,this._oldBottom=this._bottom,this._oldRight=this._right,this._oldWidth=this._width,this._oldHeight=this._height,this._oldZIndex=this._zIndex,this._oldFullScreen=this._fullScreen,this._savedPosition=!0}restorePosition(){this.setPosition({top:this._oldTop,left:this._oldLeft,bottom:this._oldBottom,right:this.oldRight,width:this._oldWidth,height:this._oldHeight,zIndex:this._oldZIndex,fullScreen:this._oldFullScreen})}setPosition(t){const{top:e,left:i,bottom:s,right:o,width:n=this._width,height:a=this._height,zIndex:r=this.zIndex,fullScreen:c=this._fullScreen}=t;this._top=s?void 0:e,this._left=o?void 0:i,this._bottom=e?void 0:s,this._right=i?void 0:o,this._width=n,this._height=a,this._zIndex=r,this._fullScreen=c,s&&!e&&(this._top=h.height-s-a,this._bottom=void 0),o&&!i&&(this._left=h.width-o-n,this._right=void 0),this._fullScreen?(this._offscreenCanvas.width=h.width,this._offscreenCanvas.height=h.height):(this._offscreenCanvas.width=n,this._offscreenCanvas.height=a),this.draw()}get top(){return this._top}set top(t){this._top=t}get left(){return this._left}set left(t){this._left=t}get width(){return this._width}set width(t){this._width=t,this._offscreenCanvas.width=t}get height(){return this._height}set height(t){this._height=t,this._offscreenCanvas.height=t}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t}set outLine(t){this._outline=t}get createdAt(){return this._createdAt}}var E=(()=>{let t=[],e=null,i=null,a=null,r=null,d=null;const u=t=>{(r=document.getElementById(a)).srcObject=t,r.play()},l=e=>{const i=t.findIndex(t=>t.id===e);return t[i]},f=()=>"_"+Math.random().toString(36).substr(2,9),_=async function(){const t=new MediaStream;e.getVideoTracks().forEach(function(e){t.addTrack(e)}),i.getAudioTracks().forEach(function(e){t.addTrack(e)}),d=t};return{init:async(o,h)=>{a=h,(e=new C(o,h)).drawCalcDeltaTime(),i=new n,await _(),u(d),s.init(t,e)},addMedia:(s={source:source,sourceType:"stream",video:{},audio:{},onended:onended})=>new Promise(async(n,h)=>{const{source:a,sourceType:r}=s,c=f(),d=document.createElement("video");"url"===r?(d.muted=!1,d.autoplay=!0,d.src=a,d.load(),s.video.startTime&&(d.currentTime=s.video.startTime),d.crossOrigin="anonymous"):("mycam"===s.audio.mediaType&&(d.muted=!0),d.srcObject=a,s.video.startTime&&(d.currentTime=s.video.startTime)),d.play().then(()=>{"url"===r&&(d.crossOrigin="anonymous"),s.onended&&(d.onended=()=>{s.onended(c)}),t.push({id:c,videoEl:d,stream:"stream"===r?a:null});const h=new p({id:c,source:d,sourceType:r,...s.video});if(e.addVideoObject(h),"url"===r){const t=new o({id:c,source:d,sourceType:r,context:i.getContext(),destination:i.getDestination(),...s.audio});i.addAudioObject(t)}else if(a.getAudioTracks&&0!==a.getAudioTracks().length){const t=new o({id:c,source:a,sourceType:r,context:i.getContext(),destination:i.getDestination(),...s.audio});i.addAudioObject(t)}n({objID:c})}).catch(t=>{console.log(t.toString()),h({err:"not play video"})})}),removeMedia:s=>{const o=t.findIndex(t=>t.id===s);-1!==o&&t[o]?(e.removeVideoObject(s),i.removeAudioObject(s),t[o].videoEl&&(t[o].videoEl=void 0),t.splice(o,1)):console.log(`[StreamMixer] %cNot Found MediaObject : ${s}`,"background: red; color: #fff")},changeStream:(t,e)=>new Promise((i,s)=>{let o=l(t);return o||s("not found mediaObject"),o.videoEl.srcObject=e,o.videoEl.play(),i()}),getStream:function(){return console.log(d),d},getAudioTracks:function(){return i.getAudioTracks()},SCREEN:h,PRESET_POSITION:c,enableCanvas:function(t,i){e.enableCanvas(t,i)},pause:function(t){l(t).videoEl.pause()},play:function(t){l(t).videoEl.play()},mute:function(t,e){i.mute(t,e)},setVolume:function(t,e){i.setVolume(t,e)},getCurrentTime:function(e){const i=t.findIndex(t=>t.id===e),s=t[i];return s?s.videoEl.currentTime:0},setCurrentTime:function(e,i){const s=t.findIndex(t=>t.id===e),o=t[s];o&&(o.videoEl.currentTime=i)},setPosition:function(t){const i=e.getVideoObject(t.id);i&&(i.setPosition(t),e.sortVideoObjectList())},setDrawMode:function(t){e.setDrawMode(t)},Debug:{...s}}})();e.default=E}])});
//# sourceMappingURL=stream-mixer.min.map